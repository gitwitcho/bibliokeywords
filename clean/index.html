
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/clean/">
      
      
        <link rel="prev" href="../utilities/">
      
      
        <link rel="next" href="../config/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.12">
    
    
      
        <title>Clean - BiblioKeywords</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#clean" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="BiblioKeywords" class="md-header__button md-logo" aria-label="BiblioKeywords" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BiblioKeywords
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Clean
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="BiblioKeywords" class="md-nav__button md-logo" aria-label="BiblioKeywords" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    BiblioKeywords
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../utilities/" class="md-nav__link">
        Utilities
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Clean
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Clean
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clean" class="md-nav__link">
    Clean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean" class="md-nav__link">
    src.clean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.add_biblio_source" class="md-nav__link">
    add_biblio_source()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.add_search_label" class="md-nav__link">
    add_search_label()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.clean_biblio_df" class="md-nav__link">
    clean_biblio_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_affils_dims" class="md-nav__link">
    format_auth_affils_dims()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_affils_scopus" class="md-nav__link">
    format_auth_affils_scopus()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_dims" class="md-nav__link">
    format_auth_dims()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_lens" class="md-nav__link">
    format_auth_lens()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_scopus" class="md-nav__link">
    format_auth_scopus()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.get_biblio_source_string" class="md-nav__link">
    get_biblio_source_string()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.modify_cols_biblio_df" class="md-nav__link">
    modify_cols_biblio_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.normalise_biblio_entities" class="md-nav__link">
    normalise_biblio_entities()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.remove_title_duplicates" class="md-nav__link">
    remove_title_duplicates()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../config/" class="md-nav__link">
        Config
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#clean" class="md-nav__link">
    Clean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean" class="md-nav__link">
    src.clean
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.add_biblio_source" class="md-nav__link">
    add_biblio_source()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.add_search_label" class="md-nav__link">
    add_search_label()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.clean_biblio_df" class="md-nav__link">
    clean_biblio_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_affils_dims" class="md-nav__link">
    format_auth_affils_dims()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_affils_scopus" class="md-nav__link">
    format_auth_affils_scopus()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_dims" class="md-nav__link">
    format_auth_dims()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_lens" class="md-nav__link">
    format_auth_lens()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.format_auth_scopus" class="md-nav__link">
    format_auth_scopus()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.get_biblio_source_string" class="md-nav__link">
    get_biblio_source_string()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.modify_cols_biblio_df" class="md-nav__link">
    modify_cols_biblio_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.normalise_biblio_entities" class="md-nav__link">
    normalise_biblio_entities()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.clean.remove_title_duplicates" class="md-nav__link">
    remove_title_duplicates()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Clean</h1>

<h2 id="clean">Clean</h2>


<div class="doc doc-object doc-module">


<a id="src.clean"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="src.clean.add_biblio_source" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_biblio_source</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">,</span> <span class="n">biblio_source</span><span class="o">=</span><span class="n">BiblioSource</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Adds a bibliography source column to <code>biblio_df</code> based on the specified <code>BiblioSource</code>.</p>
<p>Use this function in case the <code>bib_src</code> has not been set correctly or the bibliographic
dataset wasn't read with <code>read_biblio_csv_files_to_df</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_df</code></td>
          <td>
          </td>
          <td><p>The bibliographic dataset to add the bibliography source column to.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>biblio_source</code></td>
          <td>
                <code>BiblioSource</code>
          </td>
          <td><p>The bibliography source: <code>SCOPUS</code>, <code>LENS</code>, <code>DIMS</code>, <code>BIBLIO</code>. See <code>config.py</code> for 
an updated list.</p></td>
          <td>
                <code>BiblioSource.UNDEFINED</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>pd.DataFrame: The modified DataFrame with the bibliography source column added.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_biblio_source</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                      <span class="n">biblio_source</span><span class="p">:</span> <span class="n">BiblioSource</span> <span class="o">=</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">UNDEFINED</span>
                      <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a bibliography source column to `biblio_df` based on the specified `BiblioSource`.</span>

<span class="sd">    Use this function in case the `bib_src` has not been set correctly or the bibliographic</span>
<span class="sd">    dataset wasn&#39;t read with `read_biblio_csv_files_to_df`.</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_df: </span>
<span class="sd">            The bibliographic dataset to add the bibliography source column to.</span>
<span class="sd">        biblio_source: </span>
<span class="sd">            The bibliography source: `SCOPUS`, `LENS`, `DIMS`, `BIBLIO`. See `config.py` for </span>
<span class="sd">            an updated list.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The modified DataFrame with the bibliography source column added.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;scopus&#39;</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">LENS</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lens&#39;</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;dims&#39;</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">BIBLIO</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;biblio&#39;</span>

    <span class="k">return</span> <span class="n">biblio_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.add_search_label" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_search_label</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">,</span> <span class="n">search_label</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Add a column <code>search_label</code> to <code>biblio_df</code>.</p>
<p>In some cases, especially when merging bibliographic datasets from different sources, it is helpful to
know where the searches come from or what particular search terms were used. The <code>search_label</code>
of merged datasets are merged into a list.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_df</code></td>
          <td>
          </td>
          <td><p>The input bibliographic <code>DataFrame</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>search_label</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The search label that will be added to the column 'search_label.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The bibliographic dataset <code>biblio_df</code> with the new column <code>search_label</code>.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_search_label</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                     <span class="n">search_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Add a column `search_label` to `biblio_df`.</span>

<span class="sd">    In some cases, especially when merging bibliographic datasets from different sources, it is helpful to</span>
<span class="sd">    know where the searches come from or what particular search terms were used. The `search_label`</span>
<span class="sd">    of merged datasets are merged into a list.</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_df: </span>
<span class="sd">            The input bibliographic `DataFrame`.</span>
<span class="sd">        search_label:</span>
<span class="sd">            The search label that will be added to the column &#39;search_label.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The bibliographic dataset `biblio_df` with the new column `search_label`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;search_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">search_label</span>

    <span class="k">return</span> <span class="n">biblio_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.clean_biblio_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">clean_biblio_df</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Cleans the bibliographic dataset <code>biblio_df</code> by processing the publication titles
and abstracts to remove noise and standardise formatting.</p>
<p>The function removes publications with empty titles, NaN titles, and titles containing 
specific keywords such as 'conference', 'workshop', 'proceedings'. It converts titles to 
lowercase, removes HTML tags, non-alphabetic characters (except specific punctuation and 
Greek letters), excess whitespace, and common terms from the beginning of titles.</p>
<p>For abstracts, the function replaces NaN values with empty strings, removes HTML tags, 
non-alphabetic characters (except specific punctuation and Greek letters), excess whitespace, 
and common terms used in abstracts of publications in some disciplines such as 'background', 
'objectives', 'results' etc. It also removes duplicate publications using the function 
<code>remove_title_duplicates</code> and generates standard publication IDs.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_df</code></td>
          <td>
          </td>
          <td><p>Input DataFrame containing bibliographic information.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Cleaned bibligraphic dataset with standardized publication titles, abstracts, and new publication IDs.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_biblio_df</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Cleans the bibliographic dataset `biblio_df` by processing the publication titles</span>
<span class="sd">    and abstracts to remove noise and standardise formatting.</span>

<span class="sd">    The function removes publications with empty titles, NaN titles, and titles containing </span>
<span class="sd">    specific keywords such as &#39;conference&#39;, &#39;workshop&#39;, &#39;proceedings&#39;. It converts titles to </span>
<span class="sd">    lowercase, removes HTML tags, non-alphabetic characters (except specific punctuation and </span>
<span class="sd">    Greek letters), excess whitespace, and common terms from the beginning of titles.</span>

<span class="sd">    For abstracts, the function replaces NaN values with empty strings, removes HTML tags, </span>
<span class="sd">    non-alphabetic characters (except specific punctuation and Greek letters), excess whitespace, </span>
<span class="sd">    and common terms used in abstracts of publications in some disciplines such as &#39;background&#39;, </span>
<span class="sd">    &#39;objectives&#39;, &#39;results&#39; etc. It also removes duplicate publications using the function </span>
<span class="sd">    `remove_title_duplicates` and generates standard publication IDs.</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_df: </span>
<span class="sd">            Input DataFrame containing bibliographic information.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cleaned bibligraphic dataset with standardized publication titles, abstracts, and new publication IDs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        None.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO:</span>
    <span class="c1">#   - Handle &quot;No abstract available&quot; in Scopus.</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Number of publications in the input biblio_df: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">biblio_df</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleaning the publication titles</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Remove publications with empty titles</span>
    <span class="n">count_titles_empty</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removed </span><span class="si">{</span><span class="n">count_titles_empty</span><span class="si">}</span><span class="s1"> titles that were empty strings&#39;</span><span class="p">)</span>

    <span class="c1"># Remove all titles that are NaN</span>
    <span class="n">count_titles_nan</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_none_nan_empty</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removed </span><span class="si">{</span><span class="n">count_titles_nan</span><span class="si">}</span><span class="s1"> titles that were NaN&#39;</span><span class="p">)</span>

    <span class="c1"># Remove all titles that contain &#39;conference&#39;, &#39;workshop&#39;, or &#39;proceedings&#39;</span>
    <span class="n">count_procs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;proceedings|conference|workshop&#39;</span><span class="p">,</span> <span class="n">case</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)])</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="o">~</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;proceedings|conference|workshop&#39;</span><span class="p">,</span> <span class="n">case</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removed </span><span class="si">{</span><span class="n">count_procs</span><span class="si">}</span><span class="s1"> records where the title contained &quot;conference&quot;, &quot;workshop&quot;, or &quot;proceeding&quot;&#39;</span><span class="p">)</span>

    <span class="c1"># Convert the titles to lower case except for the first word</span>
    <span class="k">def</span> <span class="nf">title_to_lc</span><span class="p">(</span><span class="n">s</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">clean_s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z]&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clean_s</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
            <span class="n">final_s</span> <span class="o">=</span> <span class="n">clean_s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">words</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="c1"># words = [words[0]] + [w.lower() if w[0].isupper() and len(w) &gt; 1 and w[1].isalpha() and not w[1].isupper() else w for w in words[1:]]</span>
            <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()))</span> <span class="k">else</span> <span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
            <span class="n">final_s</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">final_s</span>

    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">title_to_lc</span><span class="p">)</span>

    <span class="c1"># Remove text between &#39;&lt;&#39; and &#39;&gt;&#39; characters</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;.*?&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove all non-alphabetic characters except for &#39;-&#39;, &#39;,&#39;, &#39;:&#39;, &#39;)&#39;, &#39;(&#39;, &#39;$&#39;, &#39;%&#39;,  whitespace and Greek letters</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9α-ωΑ-Ω\s,:’()$%</span><span class="se">\&#39;</span><span class="s1">\&quot;\-]+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

    <span class="c1"># Replace any special whitespace character with a normal whitespace</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\u2002|\u2003|\u2005|\u2009|\u200a|\u202f|\xa0&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Replace all newline and tab characters with a white space</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n|\t&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove the word &#39;abstract&#39; at the start of any title</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)^abstract\s*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove words from the beginning of the title that are combinations of at least one number and zero or more special charcters</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[\W\d]+(?=\s)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

    <span class="c1"># Remove any words starting with &#39;.&#39; or &#39;-&#39; and any single letter except &#39;a&#39; from the beginning of the title and abstract</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-.]+\s*\w+\s*|[-.]+(?!\w)|(\s|^)[^Aa\s+](\s+|$)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove excess whitespace</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="c1"># Remove any remaining empty titles</span>
    <span class="n">count_titles</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Removed additional </span><span class="si">{</span><span class="n">count_titles</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">biblio_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> titles that were empty strings&#39;</span><span class="p">)</span>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleaning the publication abstracts</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Replace all abstracts that are NaN with empty strings</span>
    <span class="n">count_abs_nan</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_none_nan_empty</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Replaced </span><span class="si">{</span><span class="n">count_abs_nan</span><span class="si">}</span><span class="s1"> abtracts that were NaN with an empty string&#39;</span><span class="p">)</span>

    <span class="c1"># Remove text between &#39;&lt;&#39; and &#39;&gt;&#39; characters</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;&lt;.*?&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove all non-alphabetic characters except for &#39;.&#39;, &#39;-&#39;, &#39;,&#39;, &#39;:&#39;, &#39;)&#39;, &#39;(&#39;, &#39;$&#39;, &#39;%&#39;,  whitespace and Greek letters</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z0-9α-ωΑ-Ω\s.,:’()$%</span><span class="se">\&#39;</span><span class="s1">\&quot;\-]+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

    <span class="c1"># Replace any special whitespace character with a normal whitespace</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\u2002|\u2003|\u2005|\u2009|\u200a|\u202f|\xa0&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Replace all newline and tab characters with a white space</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n|\t&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove the word &#39;abstract&#39; and &#39;objective&#39; at the start of any abstract</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)^abstract\s*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?i)^objective(s)?\s*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove the following common terms from the abstract independently of the case</span>
    <span class="n">remove_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">,</span> <span class="s1">&#39;objective&#39;</span><span class="p">,</span> <span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;conclusions&#39;</span><span class="p">,</span> <span class="s1">&#39;introduction&#39;</span><span class="p">]</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">remove_strings</span><span class="p">)</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">))</span>

    <span class="c1"># Remove any words starting with &#39;.&#39; or &#39;-&#39; and any single letter except &#39;a&#39; from the beginning of the title and abstract</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[-.]+\s*\w+\s*|(\s|^)[^Aa\s+](\s+|$)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Remove excess whitespace</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>


<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removing duplicate publications</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">remove_title_duplicates</span><span class="p">(</span><span class="n">biblio_df</span><span class="p">)</span>


    <span class="c1"># Convert year to integer and replace nan with zeros (in Lens, year is a float)</span>
    <span class="k">if</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate the new publication IDs</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Sort the dataset before creating the ids</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">],</span> <span class="n">ascending</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">],</span> <span class="n">na_position</span><span class="o">=</span><span class="s1">&#39;last&#39;</span><span class="p">)</span>

    <span class="c1"># Generate the record IDs</span>
    <span class="k">global</span> <span class="n">counter</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">generate_id</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">counter</span>
        <span class="n">author</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;no author name&quot;</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">author</span> <span class="o">=</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">author</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">author</span> <span class="o">=</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">author</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
        <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="nb">id</span>

    <span class="c1"># Make sure the index is properly set (starts at 0, then at unit increments)</span>
    <span class="n">biblio_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Generate the unique identifiers for the publications</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">generate_id</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">biblio_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.format_auth_affils_dims" class="doc doc-heading">
<code class="highlight language-python"><span class="n">format_auth_affils_dims</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reformats the authors-affilitions string of a Dimensions publication in a CSV export.</p>
<p>The normalised format is</p>
<ul>
<li>For a single author-affiliation: <code>Surname, Initials (Affiliation(s))</code> (e.g. Jin, X. (Luxembourg School of Finance, University of Luxembourg, Luxembourg))</li>
<li>For multipe authors-affiliations: `Surname1, Initials1 (Affiliation(s)1); Surname 2, Initials2 (Affiliation(s)2)</li>
</ul>
<p>Example of a Scopus authors-affiliations names string: <code>Schweizer, Pia‐Johanna (Institute for Advanced Sustainability Studies (IASS), Potsdam, Germany); Goble, Robert (Clark University, Worcester, MA, USA)</code></p>
<p>!!! note
    Since Lens does not provide affiliation information, there is no corresponding function <code>format_auth_affils_lens</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>auth_affils_str</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The authors-affiliations as a string in Dimensions format. Handles NaN via <code>float</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The formatted authors-affiliations string or NaN if missing.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_auth_affils_dims</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reformats the authors-affilitions string of a Dimensions publication in a CSV export.</span>

<span class="sd">    The normalised format is</span>

<span class="sd">    - For a single author-affiliation: `Surname, Initials (Affiliation(s))` (e.g. Jin, X. (Luxembourg School of Finance, University of Luxembourg, Luxembourg))</span>
<span class="sd">    - For multipe authors-affiliations: `Surname1, Initials1 (Affiliation(s)1); Surname 2, Initials2 (Affiliation(s)2)</span>

<span class="sd">    Example of a Scopus authors-affiliations names string: `Schweizer, Pia‐Johanna (Institute for Advanced Sustainability Studies (IASS), Potsdam, Germany); Goble, Robert (Clark University, Worcester, MA, USA)`</span>

<span class="sd">    !!! note</span>
<span class="sd">        Since Lens does not provide affiliation information, there is no corresponding function `format_auth_affils_lens`.</span>

<span class="sd">    Args:</span>
<span class="sd">        auth_affils_str: </span>
<span class="sd">            The authors-affiliations as a string in Dimensions format. Handles NaN via `float`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The formatted authors-affiliations string or NaN if missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO:</span>
    <span class="c1"># - Add a try/except to catch cases where strings are ill-formed and print a warning. These cases cannot be</span>
    <span class="c1">#   handled here, but the user might be able to fix it manually.</span>

    <span class="n">auth_affils</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">splits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># stack to keep track of open parentheses</span>
        <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># starting index of the current substring</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">char</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># add the index of opening parentheses to the stack</span>
            <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span> <span class="ow">and</span> <span class="n">stack</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>  <span class="c1"># remove the index of matching opening parentheses from the stack</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">auth_affils_str</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span>
                    <span class="c1"># If stack is empty and &#39;;&#39; is followed by the substring, split the string</span>
                    <span class="n">splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="n">splits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">[</span><span class="n">start</span><span class="p">:])</span>  <span class="c1"># append the remaining part of the string</span>
        <span class="n">auth_affils</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span> <span class="n">maxsplit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">splits</span><span class="p">]</span> <span class="c1"># split each author-affiliation at the first opening parenthesis</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">auth_affil_str_lst</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">auth_affil</span> <span class="ow">in</span> <span class="n">auth_affils</span><span class="p">:</span>

        <span class="c1"># Extract the affiliation, if present</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">auth_affil</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">affiliation</span> <span class="o">=</span> <span class="n">auth_affil</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">auth_affil</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">auth_affil</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">affiliation</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Extract the author information, if present</span>
        <span class="k">if</span> <span class="n">auth_affil</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">author_parts</span> <span class="o">=</span> <span class="n">auth_affil</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">surname</span> <span class="o">=</span> <span class="n">author_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">author_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">name_parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">author_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()]</span>

                <span class="c1"># Format the author name using the first letter of each name part</span>
                <span class="n">initials</span> <span class="o">=</span> <span class="p">[</span><span class="n">part</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">part</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">part</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">name_parts</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># No author information</span>
            <span class="n">surname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Construct the normalised author-affiliation string</span>
        <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="n">surname</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">surname</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">affiliation</span><span class="si">}</span><span class="s1">)&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">surname</span><span class="si">}</span><span class="s1">, N.A. (</span><span class="si">{</span><span class="n">affiliation</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">elif</span> <span class="n">affiliation</span><span class="p">:</span>
            <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Anonymous, N.A. (</span><span class="si">{</span><span class="n">affiliation</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Anonymous, N.A. ()&#39;</span>

        <span class="n">auth_affil_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auth_affil_str</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">auth_affil_str_lst</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">auth_affil_str_lst</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">normalised_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.format_auth_affils_scopus" class="doc doc-heading">
<code class="highlight language-python"><span class="n">format_auth_affils_scopus</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reformats the authors-affilitions string of a Scopus publication in a CSV export.</p>
<p>The normalised format is</p>
<ul>
<li>For a single author-affiliation: <code>Surname, Initials (Affiliation(s))</code> (e.g. Jin, X. (Luxembourg School of Finance, University of Luxembourg, Luxembourg))</li>
<li>For multipe authors-affiliations: `Surname1, Initials1 (Affiliation(s)1); Surname 2, Initials2 (Affiliation(s)2)</li>
</ul>
<p>Example of a Scopus authors-affiliations names string: <code>Blundell-Wignall, A., Enterprise Affairs, OECD, France; Roulet, C., Enterprise Affairs, OECD, France</code></p>
<p>!!! note
    Since Lens does not provide affiliation information, there is no corresponding function <code>format_auth_affils_lens</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>auth_affils_str</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The authors-affiliations as a string in Scopus format. Handles NaN via <code>float</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The formatted authors-affiliations string or NaN if missing.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_auth_affils_scopus</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reformats the authors-affilitions string of a Scopus publication in a CSV export.</span>

<span class="sd">    The normalised format is</span>

<span class="sd">    - For a single author-affiliation: `Surname, Initials (Affiliation(s))` (e.g. Jin, X. (Luxembourg School of Finance, University of Luxembourg, Luxembourg))</span>
<span class="sd">    - For multipe authors-affiliations: `Surname1, Initials1 (Affiliation(s)1); Surname 2, Initials2 (Affiliation(s)2)</span>

<span class="sd">    Example of a Scopus authors-affiliations names string: `Blundell-Wignall, A., Enterprise Affairs, OECD, France; Roulet, C., Enterprise Affairs, OECD, France`</span>

<span class="sd">    !!! note</span>
<span class="sd">        Since Lens does not provide affiliation information, there is no corresponding function `format_auth_affils_lens`.</span>

<span class="sd">    Args:</span>
<span class="sd">        auth_affils_str: </span>
<span class="sd">            The authors-affiliations as a string in Scopus format. Handles NaN via `float`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The formatted authors-affiliations string or NaN if missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">auth_affils</span> <span class="o">=</span><span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">auth_affils_str</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>  <span class="c1"># prevents a Pylance error in x.split()</span>
        <span class="k">if</span> <span class="n">auth_affils_str</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="c1"># Split auth_affils_str into individual author-affiliation pairs</span>
            <span class="n">auth_affils</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\.\s*,|.\s+,\s*&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">maxsplit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">auth_affils_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)]</span>

            <span class="c1"># Format each author-affiliation pair</span>
            <span class="n">auth_affils</span> <span class="o">=</span> <span class="p">[[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> 
                        <span class="p">[</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span> <span class="k">for</span> <span class="n">parts</span> <span class="ow">in</span> <span class="n">auth_affils</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If auth_affils_str is an empty string, return a default anonymous author-affiliation</span>
            <span class="k">return</span> <span class="s1">&#39;Anonymous, N.A. ()&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="n">auth_affil_str_lst</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">auth_affil</span> <span class="ow">in</span> <span class="n">auth_affils</span><span class="p">:</span>

        <span class="c1"># Create the formatted author-affiliation string in the normalised format</span>
        <span class="c1"># If author_affil has just one element (author or affiliation), assume that the affiliation rather than the author name is missing</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">auth_affil</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> ()&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auth_affil</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">auth_affil_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">auth_affil</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">auth_affil</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="n">auth_affil_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">auth_affil_str</span><span class="p">)</span>

    <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">auth_affil_str_lst</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">normalised_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.format_auth_dims" class="doc doc-heading">
<code class="highlight language-python"><span class="n">format_auth_dims</span><span class="p">(</span><span class="n">authors</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reformats the author names string of a Dimensions publication in a CSV export.</p>
<p>The normalised format is</p>
<ul>
<li>For a single author: <code>Surname, Initials</code> (e.g. Smith, J.A.)</li>
<li>For multipe authors: `Surname1, Initials1; Surname 2, Initials2 (e.g. Martínez, X.; Müller, H.W.)</li>
</ul>
<p>Example of a Dimensions author names string: <code>Bai, Xiao; Sun, Huaping; Lu, Shibao; Taghizadeh-Hesary, Farhad</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>authors</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The author names as a string in Dimensions format. Handles NaN via <code>float</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The formatted author names as a string or NaN if missing.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_auth_dims</span><span class="p">(</span><span class="n">authors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reformats the author names string of a Dimensions publication in a CSV export.</span>

<span class="sd">    The normalised format is</span>

<span class="sd">    - For a single author: `Surname, Initials` (e.g. Smith, J.A.)</span>
<span class="sd">    - For multipe authors: `Surname1, Initials1; Surname 2, Initials2 (e.g. Martínez, X.; Müller, H.W.)</span>

<span class="sd">    Example of a Dimensions author names string: `Bai, Xiao; Sun, Huaping; Lu, Shibao; Taghizadeh-Hesary, Farhad`</span>

<span class="sd">    Args:</span>
<span class="sd">        authors: </span>
<span class="sd">            The author names as a string in Dimensions format. Handles NaN via `float`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The formatted author names as a string or NaN if missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">authors</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">authors_lst</span> <span class="o">=</span> <span class="n">authors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

        <span class="n">authors_str_lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">authors_lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="c1"># Split author name into parts (surname and initials)</span>
                <span class="n">author</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">author_parts</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">surname</span> <span class="o">=</span> <span class="n">author_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">author_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">initials</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">author_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="n">initials</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">initials</span> <span class="o">=</span> <span class="s1">&#39;N.A.&#39;</span>

                <span class="c1"># Create normalised author string</span>
                <span class="n">author_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">surname</span><span class="p">,</span> <span class="n">initials</span><span class="p">)</span>
                <span class="n">authors_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author_str</span><span class="p">)</span>

        <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">authors_str_lst</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalised_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[N&#39;</span><span class="p">):</span>
            <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>

        <span class="k">return</span> <span class="n">normalised_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.format_auth_lens" class="doc doc-heading">
<code class="highlight language-python"><span class="n">format_auth_lens</span><span class="p">(</span><span class="n">authors</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reformats the author names string of a Lens publication in a CSV export.</p>
<p>The normalised format is</p>
<ul>
<li>For a single author: <code>Surname, Initials</code> (e.g. Smith, J.A.)</li>
<li>For multipe authors: `Surname1, Initials1; Surname 2, Initials2 (e.g. Martínez, X.; Müller, H.W.)</li>
</ul>
<p>Example of a Lens author names string: <code>Elena L. Mishchenko; A. M. Mishchenko; Vladimir A. Ivanisenko</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>authors</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The author names as a string in Lens format. Handles NaN via <code>float</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The formatted author names as a string or NaN if missing.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_auth_lens</span><span class="p">(</span><span class="n">authors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reformats the author names string of a Lens publication in a CSV export.</span>

<span class="sd">    The normalised format is</span>

<span class="sd">    - For a single author: `Surname, Initials` (e.g. Smith, J.A.)</span>
<span class="sd">    - For multipe authors: `Surname1, Initials1; Surname 2, Initials2 (e.g. Martínez, X.; Müller, H.W.)</span>

<span class="sd">    Example of a Lens author names string: `Elena L. Mishchenko; A. M. Mishchenko; Vladimir A. Ivanisenko`</span>

<span class="sd">    Args:</span>
<span class="sd">        authors: </span>
<span class="sd">            The author names as a string in Lens format. Handles NaN via `float`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The formatted author names as a string or NaN if missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">authors</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">authors_lst</span> <span class="o">=</span> <span class="n">authors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>

        <span class="n">authors_str_lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">authors_lst</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                    <span class="c1"># Split author name into parts (surname and initials)</span>
                    <span class="n">author_parts</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">surname</span> <span class="o">=</span> <span class="n">author_parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">author_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">initials</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">author_parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                        <span class="n">initials</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">initials</span> <span class="o">=</span> <span class="s1">&#39;N.A.&#39;</span>

                    <span class="c1"># Create normalised author string</span>
                    <span class="n">author_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">surname</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">initials</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">authors_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author_str</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed with author name &#39;</span><span class="si">{</span><span class="n">author</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">authors_str_lst</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalised_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[N&#39;</span><span class="p">):</span>
            <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>

        <span class="k">return</span> <span class="n">normalised_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Anonymous, NA.&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.format_auth_scopus" class="doc doc-heading">
<code class="highlight language-python"><span class="n">format_auth_scopus</span><span class="p">(</span><span class="n">authors</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Reformats the author names string of a Scopus publication in a CSV export.</p>
<p>The normalised format is</p>
<ul>
<li>For a single author: <code>Surname, Initials</code> (e.g. Smith, J.A.)</li>
<li>For multipe authors: `Surname1, Initials1; Surname 2, Initials2 (e.g. Martínez, X.; Müller, H.W.)</li>
</ul>
<p>Example of a Scopus author names string: <code>Alexandre M., Silva T.C., Michalak K., Rodrigues F.A.</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>authors</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The author names as a string in Scopus format. Handles NaN via <code>float</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The formatted author names as a string or NaN if missing.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_auth_scopus</span><span class="p">(</span><span class="n">authors</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reformats the author names string of a Scopus publication in a CSV export.</span>

<span class="sd">    The normalised format is</span>

<span class="sd">    - For a single author: `Surname, Initials` (e.g. Smith, J.A.)</span>
<span class="sd">    - For multipe authors: `Surname1, Initials1; Surname 2, Initials2 (e.g. Martínez, X.; Müller, H.W.)</span>

<span class="sd">    Example of a Scopus author names string: `Alexandre M., Silva T.C., Michalak K., Rodrigues F.A.`</span>

<span class="sd">    Args:</span>
<span class="sd">        authors: </span>
<span class="sd">            The author names as a string in Scopus format. Handles NaN via `float`.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The formatted author names as a string or NaN if missing.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">authors</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">authors</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">authors_lst</span> <span class="o">=</span> <span class="n">authors</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="n">authors_str_lst</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">author</span> <span class="ow">in</span> <span class="n">authors_lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
                <span class="c1"># Split author name into parts (surname and initials)</span>
                <span class="n">author_parts</span> <span class="o">=</span> <span class="n">author</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">surname</span> <span class="o">=</span> <span class="n">author_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">author_parts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">initials</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">author_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="n">initials</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">initials</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">initials</span> <span class="o">=</span> <span class="s1">&#39;N.A.&#39;</span>

                <span class="c1"># Create normalised author string</span>
                <span class="n">author_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">surname</span><span class="p">,</span> <span class="n">initials</span><span class="p">)</span>
                <span class="n">authors_str_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">author_str</span><span class="p">)</span>

        <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">authors_str_lst</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalised_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;[N&#39;</span><span class="p">):</span>
            <span class="n">normalised_str</span> <span class="o">=</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>

        <span class="k">return</span> <span class="n">normalised_str</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;Anonymous, N.A.&#39;</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.get_biblio_source_string" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_biblio_source_string</span><span class="p">(</span><span class="n">biblio_source</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Retrieves the string representation of a bibliography source.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_source</code></td>
          <td>
                <code>BiblioSource</code>
          </td>
          <td><p>The source of the bibliography (e.g. <code>BiblioSource.SCOPUS</code>).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.Union">Union</span>[str, float]</code>
          </td>
          <td><p>The string representation of the bibliography source (e.g. <code>scopus</code>) or NaN if not recognized.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_biblio_source_string</span><span class="p">(</span><span class="n">biblio_source</span><span class="p">:</span> <span class="n">BiblioSource</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the string representation of a bibliography source.</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_source: The source of the bibliography (e.g. `BiblioSource.SCOPUS`).</span>

<span class="sd">    Returns:</span>
<span class="sd">        The string representation of the bibliography source (e.g. `scopus`) or NaN if not recognized.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">biblio_source_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span><span class="p">:</span>
        <span class="n">biblio_source_str</span> <span class="o">=</span> <span class="s1">&#39;scopus&#39;</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">LENS</span><span class="p">:</span>
        <span class="n">biblio_source_str</span> <span class="o">=</span> <span class="s1">&#39;lens&#39;</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span><span class="p">:</span>
        <span class="n">biblio_source_str</span> <span class="o">=</span> <span class="s1">&#39;dims&#39;</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">BIBLIO</span><span class="p">:</span>
        <span class="n">biblio_source_str</span> <span class="o">=</span> <span class="s1">&#39;biblio&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The value passed for biblio_source is invalid.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">biblio_source_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.modify_cols_biblio_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">modify_cols_biblio_df</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">,</span> <span class="n">reshape_base</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reshape_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_bib_src</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">require_cols</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Rename and retain columns in the bibliographic dataset <code>biblio_df</code> based on <code>reshape_base</code> 
with its preset criteria or on <code>reshape_filter</code>, where you define what column to retain and 
how to rename them.</p>
<p>The reshape_base parameter allows you to specify preset criteria for renaming and retaining the columns 
in the bibliographic <code>DataFrame</code>. The available values for <code>reshape_base</code> are defined in the 
<code>config.py</code> file. For each bibliographic database that can be processed (e.g.Scopus, Lens, 
Dimensions), there are three levels of detail that can be retained: <em>All</em>, <em>Full</em>, and <em>Compact</em>.</p>
<ul>
<li>The "All" level retains all the columns of the raw dataset from the respective bibliographic database:
  <code>Reshape.SCOPUS_ALL</code>, <code>Reshape.LENS_ALL</code>, <code>Reshape.DIMS_ALL</code>.</li>
<li>The "Full" level removes certain columns from <code>biblio_df</code> that might not be needed for the analysis:
  <code>Reshape.SCOPUS_FULL</code>, <code>Reshape.LENS_FULL</code>, <code>Reshape.DIMS_FULL</code>.</li>
<li>The "Compact" level is similar to "Full" and further reduces the number of columns in <code>biblio_df</code>:
  <code>Reshape.SCOPUS_COMPACT</code>, <code>Reshape.LENS_COMPACT</code>, <code>Reshape.DIMS_COMPACT</code>.</li>
</ul>
<p>Alternatively, you can use the <code>reshape_filter</code> parameter to specify a list of column names in <code>biblio_df</code> 
that you want to retain. This allows you to manually select the specific columns you need for further analysis.</p>
<p>By using either <code>reshape_base</code> or <code>reshape_filter</code>, you can customize the column selection and reshaping process 
of the bibliographic <code>DataFrame</code> based on your requirements.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_df</code></td>
          <td>
          </td>
          <td><p>The input bibliographic <code>DataFrame</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reshape_base</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[Reshape]</code>
          </td>
          <td><p>If provided, only the columns specified in the <code>reshape_base</code> criteria will be retained and renamed 
according to the predefined reshape structures (e.g. <code>reshape_struc_dims_compact</code>) defined in <code>config.py</code>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reshape_filter</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>, <span title="typing.List">List</span>]]</code>
          </td>
          <td><p>A list or dictionary of column names for retaining specific columns. If a <code>reshape_base</code>is provided, 
the <code>reshape_filter</code> only retains columns that are present once <code>reshape_base</code> has been applied.
- If <code>reshape_filter</code> is a list, only the columns present in the list will be retained.
- If <code>reshape_filter</code> is a dictionary, the keys represent the columns to be retained,
  and the values represent the new column names.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>keep_bib_src</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Flag indicating whether to retain the 'bib_src' column in the output <code>DataFrame</code>. Otherwise
it will be removed when applying <code>rehshape_base</code>and <code>reshape_column</code>(unless you provide it in the list).
The values in <code>bib_src</code> are used in some of the other functions. </p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>require_cols</code></td>
          <td>
          </td>
          <td><ul>
<li>True: the dataframe needs to have all the columns specified in either reshape_base and/or reshape_filter</li>
<li>False: columns in reshape_base and/or reshape_filter that are not in the dataframe are ignored</li>
</ul></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The modified bibliographic <code>DataFrame</code>.</p></td>
        </tr>
    </tbody>
  </table>

  <p><strong>Raises:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ValueError</code>
          </td>
          <td><ul>
<li>If any of the columns specified in <code>reshape_base</code> are not found in the <code>biblio_df</code>.</li>
<li>If any of the columns specified in <code>reshape_filter</code> are not found in the <code>biblio_df</code>.</li>
</ul></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modify_cols_biblio_df</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                                     <span class="n">reshape_base</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Reshape</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">reshape_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">,</span><span class="n">List</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                     <span class="n">keep_bib_src</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                                     <span class="n">require_cols</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Rename and retain columns in the bibliographic dataset `biblio_df` based on `reshape_base` </span>
<span class="sd">    with its preset criteria or on `reshape_filter`, where you define what column to retain and </span>
<span class="sd">    how to rename them.</span>

<span class="sd">    The reshape_base parameter allows you to specify preset criteria for renaming and retaining the columns </span>
<span class="sd">    in the bibliographic `DataFrame`. The available values for `reshape_base` are defined in the </span>
<span class="sd">    `config.py` file. For each bibliographic database that can be processed (e.g.Scopus, Lens, </span>
<span class="sd">    Dimensions), there are three levels of detail that can be retained: *All*, *Full*, and *Compact*.</span>

<span class="sd">    - The &quot;All&quot; level retains all the columns of the raw dataset from the respective bibliographic database:</span>
<span class="sd">      `Reshape.SCOPUS_ALL`, `Reshape.LENS_ALL`, `Reshape.DIMS_ALL`.</span>
<span class="sd">    - The &quot;Full&quot; level removes certain columns from `biblio_df` that might not be needed for the analysis:</span>
<span class="sd">      `Reshape.SCOPUS_FULL`, `Reshape.LENS_FULL`, `Reshape.DIMS_FULL`.</span>
<span class="sd">    - The &quot;Compact&quot; level is similar to &quot;Full&quot; and further reduces the number of columns in `biblio_df`:</span>
<span class="sd">      `Reshape.SCOPUS_COMPACT`, `Reshape.LENS_COMPACT`, `Reshape.DIMS_COMPACT`.</span>

<span class="sd">    Alternatively, you can use the `reshape_filter` parameter to specify a list of column names in `biblio_df` </span>
<span class="sd">    that you want to retain. This allows you to manually select the specific columns you need for further analysis.</span>

<span class="sd">    By using either `reshape_base` or `reshape_filter`, you can customize the column selection and reshaping process </span>
<span class="sd">    of the bibliographic `DataFrame` based on your requirements.</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_df: </span>
<span class="sd">            The input bibliographic `DataFrame`.</span>
<span class="sd">        reshape_base:</span>
<span class="sd">            If provided, only the columns specified in the `reshape_base` criteria will be retained and renamed </span>
<span class="sd">            according to the predefined reshape structures (e.g. `reshape_struc_dims_compact`) defined in `config.py`.</span>
<span class="sd">        reshape_filter:</span>
<span class="sd">            A list or dictionary of column names for retaining specific columns. If a `reshape_base`is provided, </span>
<span class="sd">            the `reshape_filter` only retains columns that are present once `reshape_base` has been applied.</span>
<span class="sd">            - If `reshape_filter` is a list, only the columns present in the list will be retained.</span>
<span class="sd">            - If `reshape_filter` is a dictionary, the keys represent the columns to be retained,</span>
<span class="sd">              and the values represent the new column names.</span>
<span class="sd">        keep_bib_src:</span>
<span class="sd">            Flag indicating whether to retain the &#39;bib_src&#39; column in the output `DataFrame`. Otherwise</span>
<span class="sd">            it will be removed when applying `rehshape_base`and `reshape_column`(unless you provide it in the list).</span>
<span class="sd">            The values in `bib_src` are used in some of the other functions. </span>
<span class="sd">        require_cols:</span>
<span class="sd">            - True: the dataframe needs to have all the columns specified in either reshape_base and/or reshape_filter</span>
<span class="sd">            - False: columns in reshape_base and/or reshape_filter that are not in the dataframe are ignored</span>
<span class="sd">    Returns:</span>
<span class="sd">        The modified bibliographic `DataFrame`.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError:</span>
<span class="sd">            - If any of the columns specified in `reshape_base` are not found in the `biblio_df`.</span>
<span class="sd">            - If any of the columns specified in `reshape_filter` are not found in the `biblio_df`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">reshape_base</span><span class="p">:</span>
        <span class="n">reshape_dict</span> <span class="o">=</span> <span class="n">reshape_strucs</span><span class="p">[</span><span class="n">reshape_base</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">reshape_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">require_cols</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One or more columns not found in biblio_df: </span><span class="si">{</span><span class="n">reshape_strucs</span><span class="p">[</span><span class="n">reshape_base</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reshape_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">reshape_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>

        <span class="n">reshape_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reshape_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;bib_src&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;bib_src&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reshape_columns</span><span class="p">):</span>
            <span class="n">reshape_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bib_src&#39;</span><span class="p">)</span>

        <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="n">reshape_columns</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">reshape_dict</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">reshape_filter</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reshape_filter</span><span class="p">,</span> <span class="n">List</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">reshape_filter</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">require_cols</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One or more columns not found in biblio_df: </span><span class="si">{</span><span class="n">reshape_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reshape_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">reshape_filter</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;bib_src&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;bib_src&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reshape_filter</span><span class="p">):</span>
                <span class="n">reshape_filter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bib_src&#39;</span><span class="p">)</span>

            <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="n">reshape_filter</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">reshape_filter</span><span class="p">,</span> <span class="n">Dict</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">col</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">reshape_filter</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">require_cols</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One or more columns not found in biblio_df: </span><span class="si">{</span><span class="n">reshape_filter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reshape_filter</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">reshape_filter</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>

            <span class="n">reshape_columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reshape_filter</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="k">if</span> <span class="s1">&#39;bib_src&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reshape_columns</span><span class="p">:</span>
                <span class="n">reshape_columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;bib_src&#39;</span><span class="p">)</span>

            <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="n">reshape_columns</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">reshape_filter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">biblio_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.normalise_biblio_entities" class="doc doc-heading">
<code class="highlight language-python"><span class="n">normalise_biblio_entities</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">,</span> <span class="n">biblio_source</span><span class="o">=</span><span class="n">BiblioSource</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Converts certain values in the bibliographic dataset <code>biblio_df</code> to a normalised 
format so that datasets from different bibliographic databases can be merged.</p>
<p>The exact values that are normalised depend on the source (Scopus, Lens,...) of 
the dataset provided by 'biblio_source<code>. If</code>biblio_source<code>is not provided, the
function will try to obtain it from</code>bib_src<code>. This only works if there is just 
one bibliographic source provided in</code>bib_src<code>and it is the same for are all
publications in</code>biblio_df`.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_df</code></td>
          <td>
          </td>
          <td><p>The bibliographic dataset.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>biblio_source</code></td>
          <td>
                <code>BiblioSource</code>
          </td>
          <td><p>The bibliographic database that is the source of the bibliographic dataset.</p></td>
          <td>
                <code>BiblioSource.UNDEFINED</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The bibliographic dataset with normalised bibliographic entities.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalise_biblio_entities</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
                              <span class="n">biblio_source</span><span class="p">:</span> <span class="n">BiblioSource</span> <span class="o">=</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">UNDEFINED</span>
                              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts certain values in the bibliographic dataset `biblio_df` to a normalised </span>
<span class="sd">    format so that datasets from different bibliographic databases can be merged.</span>

<span class="sd">    The exact values that are normalised depend on the source (Scopus, Lens,...) of </span>
<span class="sd">    the dataset provided by &#39;biblio_source`. If `biblio_source` is not provided, the</span>
<span class="sd">    function will try to obtain it from `bib_src`. This only works if there is just </span>
<span class="sd">    one bibliographic source provided in `bib_src` and it is the same for are all</span>
<span class="sd">    publications in `biblio_df`.</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_df: </span>
<span class="sd">            The bibliographic dataset.</span>
<span class="sd">        biblio_source: </span>
<span class="sd">            The bibliographic database that is the source of the bibliographic dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The bibliographic dataset with normalised bibliographic entities.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">:</span>

        <span class="c1"># Check if the bib_src column exists and has consistent values</span>
        <span class="k">if</span> <span class="s1">&#39;bib_src&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

            <span class="c1"># Determine the bibliography source based on the first record</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;scopus&#39;</span><span class="p">,</span> <span class="s1">&#39;lens&#39;</span><span class="p">,</span> <span class="s1">&#39;dims&#39;</span><span class="p">,</span> <span class="s1">&#39;biblio&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;scopus&#39;</span><span class="p">:</span>
                    <span class="n">biblio_source</span> <span class="o">=</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span>
                <span class="k">elif</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;lens&#39;</span><span class="p">:</span>
                    <span class="n">biblio_source</span> <span class="o">=</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">LENS</span>
                <span class="k">elif</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;dims&#39;</span><span class="p">:</span>
                    <span class="n">biblio_source</span> <span class="o">=</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span>
                <span class="k">elif</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;biblio&#39;</span><span class="p">:</span>
                    <span class="n">biblio_source</span> <span class="o">=</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">BIBLIO</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The bib_src needs to be the same for all records in biblio_df&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;You either need to pass a biblio_source to the function or add a bib_src column&quot;</span><span class="p">)</span>

    <span class="c1"># Create the clickable link and the list of all links</span>
    <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;doi&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;https://dx.doi.org/&#39;</span> <span class="o">+</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;doi&#39;</span><span class="p">]</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">LENS</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="s1">&#39;ext_url&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;ext_url&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;source_urls&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;source_urls&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;ext_url&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;ext_url&#39;</span><span class="p">]</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Create the unified keywords lists in column &#39;kws&#39;</span>
    <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[[</span><span class="s1">&#39;kws_author&#39;</span><span class="p">,</span> <span class="s1">&#39;kws_index&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">na_rep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
            <span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">LENS</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span>
                <span class="p">[</span><span class="n">kw</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="n">row</span><span class="p">[[</span><span class="s1">&#39;kws_lens&#39;</span><span class="p">,</span> <span class="s1">&#39;mesh&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="n">na_rep</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
            <span class="p">))),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;mesh&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;mesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;; &#39;</span><span class="p">)))</span> 
                                                       <span class="k">if</span> <span class="n">is_not_none_nan_empty</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;;&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="k">else</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="n">is_not_none_nan_empty</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Normalise the authors format</span>
    <span class="k">if</span> <span class="s1">&#39;authors&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_auth_scopus</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">LENS</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_auth_lens</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_auth_dims</span><span class="p">)</span>

    <span class="c1"># Normalise the author-affiliations format</span>
    <span class="k">if</span> <span class="s1">&#39;auth_affils&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">SCOPUS</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_auth_affils_scopus</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">biblio_source</span> <span class="o">==</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">DIMS</span><span class="p">:</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">format_auth_affils_dims</span><span class="p">)</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ext_url&#39;</span><span class="p">,</span> <span class="s1">&#39;source_urls&#39;</span><span class="p">,</span> <span class="s1">&#39;kws_author&#39;</span><span class="p">,</span> <span class="s1">&#39;kws_index&#39;</span><span class="p">,</span> <span class="s1">&#39;kws_lens&#39;</span><span class="p">,</span> <span class="s1">&#39;mesh&#39;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">biblio_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="src.clean.remove_title_duplicates" class="doc doc-heading">
<code class="highlight language-python"><span class="n">remove_title_duplicates</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Removes duplicate publications by title from <code>biblio_df</code>.</p>
<p>The function takes a bibliographic dataset <code>biblio_df</code> as input and performs several 
operations to remove duplicate titles. It returns the modified <code>DataFrame</code> after removing 
duplicates.</p>
<p>The major processing steps are:</p>
<ul>
<li>Group all duplicate titles</li>
<li>For each group<ul>
<li>Merge keywords, links, bib_src, and other columns</li>
<li>Ignore the publications with missing abstracts (unless they are all missing)</li>
<li>If there are Scopus publications, use their title, abstract, and year</li>
<li>Pick the publication with the latest publish date/year. If there are several,
  then pick one at random.</li>
</ul>
</li>
</ul>
<p>The function merges:</p>
<ul>
<li>bib_src (the bibliographic sources)</li>
<li>source (the publication sources, e.g. journals, conference proceedings,...)</li>
<li>n_cited (number of citations)</li>
<li>fos (fields of study; only Lens)</li>
<li>anzsrc_2020 (Australian and New Zealand Standard Research Classification)</li>
<li>kws (keywords)</li>
<li>links (URLs to access the publication)</li>
</ul>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biblio_df</code></td>
          <td>
          </td>
          <td><p>The bibliographic dataset.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>The modified <code>DataFrame</code> after removing duplicates.</p></td>
        </tr>
    </tbody>
  </table>

<details class="assumptions" open>
  <summary>Assumptions</summary>
  <p>The titles have previously been cleaned using the function <code>clean_biblio_df</code>. If not, there is a chance that duplicate titles are being missed because of differences in lower/upper case, special characters, etc.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>src/clean.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_title_duplicates</span><span class="p">(</span><span class="n">biblio_df_</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removes duplicate publications by title from `biblio_df`.</span>

<span class="sd">    The function takes a bibliographic dataset `biblio_df` as input and performs several </span>
<span class="sd">    operations to remove duplicate titles. It returns the modified `DataFrame` after removing </span>
<span class="sd">    duplicates.</span>

<span class="sd">    The major processing steps are:</span>

<span class="sd">    - Group all duplicate titles</span>
<span class="sd">    - For each group</span>
<span class="sd">        - Merge keywords, links, bib_src, and other columns</span>
<span class="sd">        - Ignore the publications with missing abstracts (unless they are all missing)</span>
<span class="sd">        - If there are Scopus publications, use their title, abstract, and year</span>
<span class="sd">        - Pick the publication with the latest publish date/year. If there are several,</span>
<span class="sd">          then pick one at random.</span>

<span class="sd">    The function merges:</span>

<span class="sd">    - bib_src (the bibliographic sources)</span>
<span class="sd">    - source (the publication sources, e.g. journals, conference proceedings,...)</span>
<span class="sd">    - n_cited (number of citations)</span>
<span class="sd">    - fos (fields of study; only Lens)</span>
<span class="sd">    - anzsrc_2020 (Australian and New Zealand Standard Research Classification)</span>
<span class="sd">    - kws (keywords)</span>
<span class="sd">    - links (URLs to access the publication)</span>

<span class="sd">    Args:</span>
<span class="sd">        biblio_df: The bibliographic dataset.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The modified `DataFrame` after removing duplicates.</span>

<span class="sd">    Assumptions:</span>
<span class="sd">        The titles have previously been cleaned using the function `clean_biblio_df`. If not, there is a chance that duplicate titles are being missed because of differences in lower/upper case, special characters, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: Add a duplicate title check at the end of the function. Better safe than sorry.</span>
    <span class="c1"># TODO: Also check dup_df for single titles.</span>
    <span class="c1"># TODO: Check that all bib_src are of the four allowable types.</span>

    <span class="c1"># Ensure that biblio_df has columns title and bib_src</span>
    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;bib_src&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The columns &#39;title&#39; and/or &#39;bib_src&#39; are missing from the bibliographic dataset&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">biblio_df_</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">BiblioSource</span><span class="o">.</span><span class="n">is_valid_value</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One or several values in &#39;bib_src&#39; are not in </span><span class="si">{</span><span class="n">BiblioSource</span><span class="o">.</span><span class="n">valid_values_str</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># FIXME: Temporary code: write input df to file</span>
    <span class="c1"># write_df(biblio_df = biblio_df_[[&#39;authors&#39;, &#39;title&#39;, &#39;abstract&#39;, &#39;year&#39;, &#39;pub_date&#39;, </span>
    <span class="c1">#                                  &#39;n_cited&#39;, &#39;source&#39;, &#39;kws&#39;, &#39;fos&#39;, &#39;anzsrc_2020&#39;, </span>
    <span class="c1">#                                  &#39;auth_affils&#39;, &#39;link&#39;, &#39;links&#39;, &#39;bib_src&#39;, &#39;scopus_id&#39;, </span>
    <span class="c1">#                                  &#39;lens_id&#39;, &#39;dim_id&#39;]],</span>
    <span class="c1">#          biblio_project_dir = &#39;systemic_risk&#39;,</span>
    <span class="c1">#          output_dir = &#39;results&#39;,</span>
    <span class="c1">#          output_file = &#39;tmp_sr.csv&#39;)</span>

    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df_</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of publications before removing duplicate titles: </span><span class="si">{</span><span class="n">biblio_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create a dummy variable for the title that has no special characters and is lower case</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title_dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">clean_dummy_title</span><span class="p">)</span>

    <span class="c1"># Convert the years to int (Lens has the year as a float, so I force missing values there to zero)</span>
    <span class="k">if</span> <span class="s1">&#39;year&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Create column pub_date if it doesn&#39;t exist (in Scopus for instance)</span>
    <span class="k">if</span> <span class="s1">&#39;pub_date&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">NaT</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>

        <span class="c1"># Create a pub_date of 01/01/year for all missing pub_dates</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date&#39;</span><span class="p">]</span>
        <span class="n">mask_year_not_nan</span> <span class="o">=</span> <span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># biblio_df.loc[mask_year_not_nan, &#39;pub_date_dummy&#39;] = biblio_df.loc[mask_year_not_nan, &#39;pub_date_dummy&#39;] \</span>
        <span class="c1">#     .fillna(pd.to_datetime(&#39;01-01-&#39; + biblio_df.loc[mask_year_not_nan, &#39;year&#39;].astype(int).astype(str), format=&#39;%d-%m-%Y&#39;))</span>
        <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_year_not_nan</span><span class="p">,</span> <span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_year_not_nan</span><span class="p">,</span> <span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span> \
            <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;01-01-&#39;</span> <span class="o">+</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask_year_not_nan</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">))</span>


        <span class="c1"># Convert all &#39;pub_date_dummy&#39; values to datetime</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">],</span> <span class="n">errors</span> <span class="o">=</span> <span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

        <span class="c1"># Extract missing years from pub_date</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span>
            <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">biblio_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">,</span> <span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>


    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span>

    <span class="c1"># Create new columns for merged values</span>
    <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_srcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">capitalize_words_except_stopwords</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
        <span class="n">words</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">capitalized_words</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nltk_stopwords</span> <span class="k">else</span> <span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">capitalized_words</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;source&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">capitalize_words_except_stopwords</span><span class="p">)</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Dataframe for duplicate titles</span>
    <span class="n">dup_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Storing the updated values (e.g. when merging) in a dictionary and then updating</span>
    <span class="c1"># biblio_df in one go outside the loop makes the code run much faster</span>
    <span class="n">update_dict</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Storing the indices of rows to drop. This is much faster than using the drop()</span>
    <span class="c1"># function of the dataframe inside the loop. The rows are then dropped from the</span>
    <span class="c1"># dataframe biblio_df outside the loop.</span>
    <span class="n">drop_rows</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Group the rows by the titles and loop over the groups</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">biblio_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;title_dummy&#39;</span><span class="p">)):</span>

        <span class="c1"># Create a new column &#39;sources&#39; that has all the source titles</span>
        <span class="k">if</span> <span class="s1">&#39;source&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">unique_src</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_src</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                 <span class="c1">#.str.split(&#39;;&#39;).explode().str.strip().unique()</span>
                <span class="n">group</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_src</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">group</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;sources&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;sources&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>


        <span class="k">if</span><span class="p">(</span><span class="n">idx</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Duplicate group: #</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">flush</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>   <span class="c1"># &#39;\r&#39; to overwrite the previous string; &#39; &#39; to append to the right</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dup_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dup_df</span><span class="p">,</span> <span class="n">group</span><span class="p">])</span>

            <span class="c1"># Identify the duplicates by index within this group</span>
            <span class="c1"># duplicates = group.duplicated(subset = &#39;title_dummy&#39;, keep = False)</span>

            <span class="c1"># Sum the values in n_cited</span>
            <span class="k">if</span> <span class="s1">&#39;n_cited&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>

                <span class="c1"># Remove duplicate rows based on maximum &#39;n_cited&#39; value for each &#39;source&#39;</span>
                <span class="n">group_tmp</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;n_cited&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">)</span>

                <span class="c1"># Sum &#39;n_cited&#39; and assign the sum to all remaining rows</span>
                <span class="n">sum_n_cited</span> <span class="o">=</span> <span class="n">group_tmp</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">group</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sum_n_cited</span>

                <span class="c1"># biblio_df.update(group[[&#39;n_cited&#39;]])</span>
                <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                    <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;n_cited&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Merge the values in the fos column</span>
            <span class="k">if</span> <span class="s1">&#39;fos&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unique_fos</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;fos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_fos</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">unique_fos</span> <span class="o">=</span> <span class="n">unique_fos</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;fos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_fos</span><span class="p">[</span><span class="n">unique_fos</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;fos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;fos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                    <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;fos&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Merge the values in the anzsrc_2020 column</span>
            <span class="k">if</span> <span class="s1">&#39;anzsrc_2020&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unique_anzsrc</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;anzsrc_2020&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_anzsrc</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">unique_anzsrc</span> <span class="o">=</span> <span class="n">unique_anzsrc</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;anzsrc_2020&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_anzsrc</span><span class="p">[</span><span class="n">unique_anzsrc</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;anzsrc_2020&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;anzsrc_2020&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;anzsrc_2020&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Merge the values in the keywords (kws) column</span>
            <span class="k">if</span> <span class="s1">&#39;kws&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>  <span class="c1"># FIXME: Apply the missing value handling to all the above (fos, anzsrc, ...)</span>
                <span class="n">unique_kws</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> 

                <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_kws</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">unique_kws</span> <span class="o">=</span> <span class="n">unique_kws</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_kws</span><span class="p">[</span><span class="n">unique_kws</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;kws&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;kws&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Create a new column &#39;links&#39; that has all the URLs separate with a space</span>
            <span class="k">if</span> <span class="s1">&#39;links&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">unique_links</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">unique_links</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">unique_links</span> <span class="o">=</span> <span class="n">unique_links</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_links</span><span class="p">[</span><span class="n">unique_links</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;links&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;links&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Create a new column &#39;bib_srcs&#39; that has all the bib_src strings of the duplicate titles</span>
            <span class="n">unique_bib_src</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_srcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_bib_src</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_srcs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;bib_srcs&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Pick an author string</span>
            <span class="k">if</span> <span class="s1">&#39;authors&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">has_scopus</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;scopus&#39;</span><span class="p">,</span> <span class="n">case</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">na</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">filtered_group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">has_scopus</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">filtered_group</span> <span class="o">=</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">has_scopus</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">selected_row</span> <span class="o">=</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;authors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                        <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;authors&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Pick an author affiliation string</span>
            <span class="k">if</span> <span class="s1">&#39;auth_affils&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">has_scopus</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;scopus&#39;</span><span class="p">,</span> <span class="n">case</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">na</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">filtered_group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">has_scopus</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">filtered_group</span> <span class="o">=</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">has_scopus</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">selected_row</span> <span class="o">=</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;auth_affils&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                        <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;auth_affils&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># Pick a link</span>
            <span class="k">if</span> <span class="s1">&#39;link&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">has_scopus</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;scopus&#39;</span><span class="p">,</span> <span class="n">case</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">na</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">filtered_group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">empty_strings_to_nan</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">has_scopus</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">filtered_group</span> <span class="o">=</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">has_scopus</span><span class="p">]</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">selected_row</span> <span class="o">=</span> <span class="n">filtered_group</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="n">group</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected_row</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="c1"># </span>
                    <span class="k">for</span> <span class="n">row_idx</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;link&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>     <span class="c1"># NEW PERFORMANCE CODE</span>
                        <span class="n">update_dict</span><span class="p">[(</span><span class="n">row_idx</span><span class="p">,</span> <span class="s1">&#39;link&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c1"># If at least one publication in the group has an abstract,</span>
            <span class="c1"># remove any publication in the group that doesn&#39;t have an abstract</span>
            <span class="c1"># and then reset the group with the removed publications</span>
            <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_not_none_nan_empty</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>     <span class="c1"># FIXME: correct all other instances where I use dropna()</span>
                <span class="n">items_to_drop</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;abstract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_none_nan_empty</span><span class="p">)]</span>    <span class="c1"># drops all NAN and empty abstracts</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">items_to_drop</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="n">drop_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items_to_drop</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

            <span class="c1"># Check if any publication in the group has bib_src = &#39;scopus&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;scopus&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>

                <span class="c1"># Identify the duplicates within this group</span>
                <span class="n">scopus_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;scopus&#39;</span><span class="p">)</span>
                <span class="n">scopus</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">scopus_mask</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">scopus</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">items_to_keep</span> <span class="o">=</span> <span class="n">scopus</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scopus</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">scopus</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
                    <span class="n">items_to_drop</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">items_to_keep</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># drops all items except the item_to_keep</span>
                    <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">items_to_drop</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                    <span class="n">drop_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">items_to_drop</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>

            <span class="c1"># If there are several publications left, select the one with the latest</span>
            <span class="c1"># pub_date. If they are all the same, select one randomly.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="c1"># If there are multiple records with the same largest pub_date, first check whether </span>
                <span class="c1"># there is one that has a source. If there are multiple, then pick one at random</span>
                <span class="k">if</span> <span class="s1">&#39;source&#39;</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_not_none_nan_empty</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">idxmax_group</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">is_not_none_nan_empty</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                        <span class="n">idxmax_group</span> <span class="o">=</span> <span class="n">group</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">idxmax_group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">group</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">group</span><span class="p">[</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

                <span class="n">idxmax_values</span> <span class="o">=</span> <span class="n">idxmax_group</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
                <span class="n">random_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">idxmax_values</span><span class="p">)</span>

                <span class="c1"># Drop all rows except for the one with the largest pub_date</span>
                <span class="n">indices_to_drop</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">difference</span><span class="p">([</span><span class="n">random_idx</span><span class="p">])</span>
                <span class="n">group</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices_to_drop</span><span class="p">)</span>
                <span class="n">drop_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices_to_drop</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Copy single values to new columns</span>
            <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_srcs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;bib_src&#39;</span><span class="p">]</span>

    <span class="c1"># Update biblio_df with the value updates (e.g. merges) made during the duplicate scanning above</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">),</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">update_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">biblio_df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1"># Remove rows that were dropped during the duplicate scanning above</span>
    <span class="n">drop_rows</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">drop_rows</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">drop_rows</span><span class="p">)</span>


    <span class="c1"># Remove the dummy columns</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;pub_date_dummy&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">biblio_df</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;title_dummy&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Change n_cited to int</span>
    <span class="k">if</span> <span class="s1">&#39;n_cited&#39;</span> <span class="ow">in</span> <span class="n">biblio_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">biblio_df</span><span class="p">[</span><span class="s1">&#39;n_cited&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># # FIXME: Temporary code: write input df to file</span>
    <span class="c1"># write_df(biblio_df = dup_df[[&#39;authors&#39;, &#39;title&#39;, &#39;abstract&#39;, &#39;year&#39;, &#39;pub_date&#39;, </span>
    <span class="c1">#                                  &#39;n_cited&#39;, &#39;source&#39;, &#39;kws&#39;, &#39;fos&#39;, &#39;anzsrc_2020&#39;, </span>
    <span class="c1">#                                  &#39;auth_affils&#39;, &#39;link&#39;, &#39;links&#39;, &#39;bib_src&#39;, &#39;scopus_id&#39;, </span>
    <span class="c1">#                                  &#39;lens_id&#39;, &#39;dim_id&#39;]],</span>
    <span class="c1">#          biblio_project_dir = &#39;systemic_risk&#39;,</span>
    <span class="c1">#          output_dir = &#39;results&#39;,</span>
    <span class="c1">#          output_file = &#39;tmp_dup_sr.csv&#39;)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of publications after removing duplicate titles: </span><span class="si">{</span><span class="n">biblio_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">biblio_df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c2be25ad.min.js"></script>
      
    
  </body>
</html>